<!DOCTYPE html>
<html lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.5.0/font/bootstrap-icons.css" />
    <title>Search Patient</title>
</head>

<body>
<nav th:replace="~{fragments/navbar :: navbar}"></nav>
<div class="container">
    <div class="text-center my-4">
        <h2>Medication Usage Statistics</h2>
    </div>

    <div class="row justify-content-center mb-4">
        <div class="col-md-2">
            <select class="form-select" id="month-select">
                <option value="JANUARY">January</option>
                <option value="FEBRUARY">February</option>
                <option value="MARCH">March</option>
                <option value="APRIL">April</option>
                <option value="MAY">May</option>
                <option value="JUNE">June</option>
                <option value="JULY">July</option>
                <option value="AUGUST">August</option>
                <option value="SEPTEMBER">September</option>
                <option value="OCTOBER" selected>October</option>
                <option value="NOVEMBER">November</option>
                <option value="DECEMBER">December</option>
            </select>
        </div>
        <div class="col-md-2">
            <select class="form-select" id="year-select">
                <option value="2025">2025</option>
                <option value="2024" selected>2024</option>
                <option value="2023">2023</option>
                <option value="2022">2022</option>
            </select>
        </div>
        <div class="col-md-2">
            <button class="btn btn-primary" id="load-chart">Load Chart</button>
        </div>
    </div>

    <div class="container">
        <div>
            <canvas id="myChart"></canvas>
        </div>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script>
    const ctx = document.getElementById('myChart');

    let myChart = new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Red', 'Blue', 'Yellow', 'Green', 'Purple', 'Orange'],
            datasets: [{
                label: '# of Votes',
                data: [12, 19, 3, 5, 2, 3],
                borderWidth: 1
            }]
        },
        options: {
            scales: {
                y: {
                    beginAtZero: true
                }
            }
        }
    });

    // AJAX call to load data based on month and year selection
    $('#load-chart').on('click', function() {
        var selectedMonth = $('#month-select').val();
        var selectedYear = $('#year-select').val();

        if (!selectedMonth || !selectedYear) {
            alert("Please select both month and year.");
            return;
        }

        // Create the URL with query parameters for month and year
        var apiUrl = `/api/prescription/statistic?month=${selectedMonth}&year=${selectedYear}`;

        console.log(`${selectedMonth}`)
        console.log(`${selectedYear}`)

        // Perform the AJAX call to fetch data
        $.ajax({
            url: apiUrl, // The URL now contains the month and year as query parameters
            type: 'GET',
            success: function(response) {
                // Update chart with the new data
                console.log(response)
                updateChart(response.result.labels, response.result.datasets);
            },
            error: function() {
                alert('Failed to load data.');
            }
        });
    });

    $(document).ready(function() {
        var apiUrl = `/api/prescription/statistic`;

        // Perform the AJAX call to fetch data
        $.ajax({
            url: apiUrl, // The URL now contains the month and year as query parameters
            type: 'GET',
            success: function(response) {
                // Update chart with the new data
                console.log(response)
                updateChart(response.result.labels, response.result.datasets);
            },
            error: function() {
                alert('Failed to load data.');
            }
        });
    });

    // Function to update the chart with new data
    function updateChart(labels, data) {
        myChart.data.labels = labels;
        myChart.data.datasets = data;
        myChart.update();
    }
</script>
</body>
</html>